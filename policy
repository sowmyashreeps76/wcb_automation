import { expect } from '@playwright/test';
import { click, fill } from '../../../src/wcb-automation/utils/action-utils';
import { expectElementToBeVisible } from '../../../src/wcb-automation/utils/assert-utils';
import {
  getLocator,
  getLocatorByText,
  getLocatorByRole,
  getLocatorByLabel,
} from '../../../src/wcb-automation/utils/locator-utils';

/**
 * LOCATORS
 * (all wrapped in functions – same style as wcb-login-page.ts)
 */

// --- Step 18: Open the policy from Global Search ---

// Global toolbar icon (first click in your codegen)
const globalToolbarButton = () => getLocator('#FEKQc-btn');

// Policy option in menu
const policyMenuItem = () => getLocatorByText('Policy');

// Global Search textbox
const globalSearchBox = () =>
  getLocatorByRole('textbox', { name: 'Global Search' });

// Policy checkbox in search results
const policyCheckbox = () =>
  getLocatorByRole('checkbox', { name: 'checkbox' });

// Finish button to open the policy
const finishButton = () =>
  getLocatorByRole('button', { name: /Finish/ });

// --- Step 19: Add Document REG030 ---

const addDocumentMenuItem = () =>
  getLocatorByRole('menuitem', { name: /Add Document/ });

const documentField = () =>
  getLocatorByRole('textbox', { name: /Document/ });

const reg030Row = () => getLocatorByText('REG030'); // row with REG030

const documentInformationWindow = () =>
  getLocatorByText('Document Information');

// --- Step 20: Recipients / Data Elements / Turnaround ---

const recipientsTab = () => getLocatorByText('Recipients');
const recipientsPanel = () => getLocatorByLabel('Recipients');

const dataElementsTab = () => getLocatorByText('Data Elements');
const dataElementsPanel = () => getLocatorByLabel('Document Information Document');

const turnaroundTab = () => getLocatorByText('Turnaround');
const expectedReturnDaysField = () =>
  getLocatorByRole('textbox', { name: 'Expected Return Days' });

// --- Step 21: Save & Close ---

const saveButton = () =>
  getLocatorByLabel('Document Information Document').getByRole('button', {
    name: 'Save',
  });

const closeButton = () => getLocatorByText('Close');

/**
 * STEP FUNCTIONS
 * These map directly to steps 18–21 in your document.
 */

// Step 18: Open the policy
export async function openPolicyFromGlobalSearch(policyNumber: string) {
  await click(globalToolbarButton());
  await click(policyMenuItem());

  await click(globalSearchBox());
  await fill(globalSearchBox(), policyNumber);

  // usually Enter will run search, but in your codegen you just selected checkbox
  await click(policyCheckbox());
  await click(finishButton());
}

// Step 19: Select Add Document → REG030 and open Document Information
export async function addReg030Document() {
  await click(addDocumentMenuItem());

  await click(documentField());
  await fill(documentField(), 'REG030');

  await click(reg030Row());
  await click(finishButton());

  await expectElementToBeVisible(documentInformationWindow());
}

// Step 20: Confirm Recipients & Data Elements are correct
export async function verifyRecipientsAndDataElements() {
  // Recipients tab + panel visible
  await click(recipientsTab());
  await expectElementToBeVisible(recipientsPanel());

  // Data Elements tab + area visible
  await click(dataElementsTab());
  await expectElementToBeVisible(dataElementsPanel());
}

// Step 20 (Turnaround part): Confirm Expected Return Days is 300
export async function verifyExpectedReturnDaysIs300() {
  await click(turnaroundTab());
  await expectElementToBeVisible(expectedReturnDaysField());

  await expect(expectedReturnDaysField()).toHaveValue('300');
}

// Step 21: Save and Close
export async function saveAndCloseDocumentInformation() {
  await click(saveButton());
  await click(closeButton());
}




import { test } from '@playwright/test';
import {
  navigateToWCBLoginPage,
  loginSuccessfully,
} from '../pages/preferred-pom/wcb-login-page';
import {
  openPolicyFromGlobalSearch,
  addReg030Document,
  verifyRecipientsAndDataElements,
  verifyExpectedReturnDaysIs300,
  saveAndCloseDocumentInformation,
} from '../pages/preferred-pom/wcb-document-info-page';

test('REG030 – Steps 18–21: verify Expected Return Days = 300 and save', async () => {
  // Login (reuse your existing login page functions)
  await navigateToWCBLoginPage();
  await loginSuccessfully();

  // Step 18: Open the policy
  await openPolicyFromGlobalSearch('E0000877'); // use the same policy no. you used in codegen

  // Step 19: Add Document REG030
  await addReg030Document();

  // Step 20: Confirm Recipients & Data Elements, and Expected Return Days
  await verifyRecipientsAndDataElements();
  await verifyExpectedReturnDaysIs300();

  // Step 21: Save and Close the Document Information window
  await saveAndCloseDocumentInformation();
});
